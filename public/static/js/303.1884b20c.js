(self["webpackChunkchat"]=self["webpackChunkchat"]||[]).push([[303],{7303:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return st}});var s=function(){var t=this,e=t._self._c;return e("div",{ref:"box",staticClass:"home-content",class:{"home-content__show":t.to},style:{height:t.height},on:{click:function(e){t.isTool=!1}}},[t.isFriend?t._e():e("div",{staticClass:"mask"},[e("el-empty",{attrs:{description:"对方不是您的好友，无法发送消息"}}),e("p",{on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addFriend.apply(null,arguments)}}},[e("i",{staticClass:"el-icon-thumb"}),e("span",[t._v("快去添加TA为好友吧")])])],1),e("transition",{attrs:{name:"el-fade-in"}},[t.isFirework?e("Firework",{attrs:{text:t.text}}):t._e()],1),e("audio",{ref:"audio",attrs:{src:t.audioSrc},on:{play:t.play,pause:t.pause,ended:t.ended}}),e("div",{staticClass:"home-content-title"},[t.isMobile?e("a",{staticClass:"home-content-title-back",attrs:{id:"back",href:"javascript:;"},on:{click:t.goBack}}):t._e(),e("router-link",{staticClass:"home-content-title-box",attrs:{to:{name:"blog",params:{id:t.to}}}},[t.toAvatar?e("img",{staticClass:"home-content-title-img",attrs:{src:`https://zeqichat.xyz${t.toAvatar}`,alt:""}}):t._e(),e("span",{staticClass:"home-content-title-name",domProps:{innerHTML:t._s(t.filterMessage(t.formatMessage(t.toName)))}})]),e("a",{attrs:{id:"logout",href:"javascript:;"},on:{click:t.logout}},[t._v("退出")])],1),e("div",{ref:"contentList",staticClass:"home-content-content",attrs:{id:"chat-content"},on:{scroll:t.handleScroll}},[e("el-collapse-transition",[t.scrollFlag&&t.msgList.length?e("div",{staticClass:"home-content-content-item__end"},[t._v("消息到底了，快去和TA聊天吧！")]):t._e()]),t.messageEnd?t._e():e("div",{staticClass:"home-content-content-item__end"},[t._v("消息加载中...")]),t._l(t.msgList,(function(t){return e("ChatItem",{key:t.msg_id,attrs:{msg:t}})})),t.unread_msg?e("div",{staticClass:"bubble",style:{bottom:t.isDown?"80px":"220px"},on:{click:t.bubbleClick}},[t._v(t._s(t.unread_msg))]):t._e()],2),t.isMobile?e("div",{ref:"input",staticClass:"home-content-input home-content-input__mobile"},[e("div",{staticClass:"home-content-input-input"},[e("div",{staticClass:"home-content-input-btns"},[e("button",{staticClass:"round",on:{click:function(e){e.stopPropagation(),t.isTool=!t.isTool}}},[e("i",{staticClass:"el-icon-more"})])]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],ref:"textarea",attrs:{type:"text",id:"chat-input",maxlength:"1000",rows:"1",placeholder:"发送信息"},domProps:{value:t.input},on:{keydown:t.handleKeyDown,input:[function(e){e.target.composing||(t.input=e.target.value)},t.fitHeight]}}),e("div",{staticClass:"home-content-input-btns"},[e("button",{attrs:{id:"chat-send"},on:{touchstart:function(e){return e.preventDefault(),t.send.apply(null,arguments)},mousedown:t.send}},[t._v("发送")])])]),e("el-collapse-transition",[t.isTool?e("div",{staticClass:"home-content-input-tools",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"tool-item"},[e("label",{staticClass:"icon",attrs:{id:"image-send",for:"chat-file"},on:{click:function(e){e.stopPropagation(),t.accept="image/*"}}},[e("svg",{attrs:{t:"1693136544258",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5880",width:"25",height:"25"}},[e("path",{attrs:{d:"M795.925333 211.413333h-552.32c-47.722667 0-86.506667 39.552-86.506666 88.256v420.778667c0 48.704 38.784 88.277333 86.485333 88.277333h552.32c47.744 0 86.528-39.573333 86.528-88.277333V299.669333c0-48.704-38.784-88.277333-86.506667-88.277333zM214.762667 720.426667V299.669333c0-16.192 12.970667-29.44 28.821333-29.44h552.32c15.872 0 28.842667 13.248 28.842667 29.44v264.96l-141.717334-66.773333L382.570667 746.026667a30.997333 30.997333 0 0 0-3.733334 3.84h-135.253333c-15.850667 0-28.821333-13.248-28.821333-29.44z m581.162666 29.44h-326.4l221.866667-183.338667 133.354667 62.826667v91.093333c0 16.170667-12.970667 29.397333-28.821334 29.397333z",fill:"#333","p-id":"5881"}}),e("path",{attrs:{d:"M459.306667 427.669333c0-51.114667-40.661333-92.693333-90.666667-92.693333-50.005333 0-90.666667 41.578667-90.666667 92.693333s40.661333 92.693333 90.666667 92.693334c50.005333 0 90.666667-41.578667 90.666667-92.693334z m-126.378667 0c0-20.074667 16.064-36.522667 35.712-36.522666 19.648 0 35.733333 16.426667 35.733333 36.522666 0 20.074667-16.085333 36.522667-35.733333 36.522667-19.776 0-35.712-16.298667-35.712-36.522667z",fill:"#333","p-id":"5882"}})])]),e("span",{staticClass:"text"},[t._v("图片")])]),e("div",{staticClass:"tool-item"},[e("a",{staticClass:"icon",class:{"voice-active":"recording"===t.mediaRecorder?.state},attrs:{href:"javascript:;",id:"voice",title:"按住说话"},on:{mousedown:t.recordVoice,mouseup:t.sendVoice,mouseleave:t.cancelVoice,touchstart:t.recordVoice,touchend:t.sendVoice,touchleave:t.cancelVoice}},[e("svg",{attrs:{t:"1690709285923",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2312",width:"20",height:"20"}},[e("path",{attrs:{d:"M256 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z",fill:"#333","p-id":"2313"}}),e("path",{attrs:{d:"M435.7 282.8a31.9 31.9 0 0 0 0 45.2 257.4 257.4 0 0 1 0 368 32 32 0 1 0 44.9 45.6 321.4 321.4 0 0 0 0-459.2 31.9 31.9 0 0 0-44.9 0.4z",fill:"#333","p-id":"2314"}}),e("path",{attrs:{d:"M660.9 105.2a32 32 0 0 0-44.9 45.6 505.2 505.2 0 0 1 0 722.4 32 32 0 1 0 44.9 45.6 569.1 569.1 0 0 0 0-813.6z",fill:"#333","p-id":"2315"}})])]),e("span",{staticClass:"text"},[t._v("语音")])]),e("div",{staticClass:"tool-item"},[e("a",{staticClass:"icon",attrs:{href:"javascript:;"},on:{click:function(e){return e.stopPropagation(),t.keyboardEmoji.apply(null,arguments)}}},[e("svg",{attrs:{t:"1693128544238",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1543",width:"20",height:"20","data-spm-anchor-id":"a313x.search_index.0.i4.5db53a81QDmxwB"}},[e("path",{attrs:{d:"M512 989.866667C249.173333 989.866667 34.133333 774.826667 34.133333 512S249.173333 34.133333 512 34.133333s477.866667 215.04 477.866667 477.866667-215.04 477.866667-477.866667 477.866667z m0-904.533334C276.48 85.333333 85.333333 276.48 85.333333 512s191.146667 426.666667 426.666667 426.666667 426.666667-191.146667 426.666667-426.666667S747.52 85.333333 512 85.333333z",fill:"#333","p-id":"1544"}}),e("path",{attrs:{d:"M512 786.773333c-128 0-179.2-100.693333-180.906667-104.106666-6.826667-11.946667-1.706667-27.306667 11.946667-34.133334 11.946667-6.826667 27.306667-1.706667 34.133333 11.946667 1.706667 3.413333 40.96 76.8 134.826667 76.8 95.573333 0 134.826667-75.093333 134.826667-76.8 6.826667-11.946667 22.186667-17.066667 34.133333-11.946667 11.946667 6.826667 17.066667 22.186667 11.946667 34.133334-1.706667 3.413333-52.906667 104.106667-180.906667 104.106666zM715.093333 447.146667h-90.453333c-13.653333 0-25.6-11.946667-25.6-25.6s11.946667-25.6 25.6-25.6h90.453333c13.653333 0 25.6 11.946667 25.6 25.6s-10.24 25.6-25.6 25.6zM353.28 491.52c-13.653333 0-25.6-11.946667-25.6-25.6V375.466667c0-13.653333 11.946667-25.6 25.6-25.6s25.6 11.946667 25.6 25.6v90.453333c0 15.36-10.24 25.6-25.6 25.6z",fill:"#333","p-id":"1545"}})])]),e("span",{staticClass:"text"},[t._v("表情")])]),e("div",{staticClass:"tool-item"},[e("label",{staticClass:"icon",attrs:{id:"file-send",for:"chat-file"},on:{click:function(e){e.stopPropagation(),t.accept="*"}}},[e("svg",{attrs:{t:"1693141165392",viewBox:"0 0 1260 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"15906",width:"18",height:"18"}},[e("path",{attrs:{d:"M1058.848012 935.688021H88.993243l113.018307-453.124559h969.854769zM88.993243 88.839223h397.403905l52.566655 157.699962h554.052534v147.186632h-893.63312A88.837646 88.837646 0 0 0 115.802237 461.011134l-27.33466 109.338641zM1181.853983 394.251483V246.013518A88.311979 88.311979 0 0 0 1093.016337 157.701539h-490.972549l-31.014326-95.67131A88.311979 88.311979 0 0 0 486.922815 0.001577H88.993243A88.311979 88.311979 0 0 0 0.155598 88.839223V935.688021a88.837646 88.837646 0 0 0 0 10.513331v14.718663a87.260646 87.260646 0 0 0 26.808993 37.847991h5.782332a87.260646 87.260646 0 0 0 39.950657 14.718663h986.150432A88.837646 88.837646 0 0 0 1145.057325 946.201352l113.018307-453.124559a88.837646 88.837646 0 0 0-76.221649-98.82531z",fill:"#333333","p-id":"15907"}})])]),e("span",{staticClass:"text"},[t._v("文件")])])]):t._e()])],1):e("div",{ref:"input",staticClass:"home-content-input home-content-input__pc"},[e("div",{staticClass:"tool"},[e("div",{staticClass:"tool-left",on:{contextmenu:function(t){t.preventDefault(),t.stopPropagation()}}},[e("div",{staticClass:"home-content-input-btns"},[e("button",{staticClass:"home-content-input-btns__more round"},[e("label",{attrs:{id:"image-send",for:"chat-file"},on:{click:function(e){t.accept="image/*"}}},[e("svg",{staticClass:"icon",attrs:{t:"1693136544258",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5880",width:"25",height:"25"}},[e("path",{attrs:{d:"M795.925333 211.413333h-552.32c-47.722667 0-86.506667 39.552-86.506666 88.256v420.778667c0 48.704 38.784 88.277333 86.485333 88.277333h552.32c47.744 0 86.528-39.573333 86.528-88.277333V299.669333c0-48.704-38.784-88.277333-86.506667-88.277333zM214.762667 720.426667V299.669333c0-16.192 12.970667-29.44 28.821333-29.44h552.32c15.872 0 28.842667 13.248 28.842667 29.44v264.96l-141.717334-66.773333L382.570667 746.026667a30.997333 30.997333 0 0 0-3.733334 3.84h-135.253333c-15.850667 0-28.821333-13.248-28.821333-29.44z m581.162666 29.44h-326.4l221.866667-183.338667 133.354667 62.826667v91.093333c0 16.170667-12.970667 29.397333-28.821334 29.397333z",fill:"#333","p-id":"5881"}}),e("path",{attrs:{d:"M459.306667 427.669333c0-51.114667-40.661333-92.693333-90.666667-92.693333-50.005333 0-90.666667 41.578667-90.666667 92.693333s40.661333 92.693333 90.666667 92.693334c50.005333 0 90.666667-41.578667 90.666667-92.693334z m-126.378667 0c0-20.074667 16.064-36.522667 35.712-36.522666 19.648 0 35.733333 16.426667 35.733333 36.522666 0 20.074667-16.085333 36.522667-35.733333 36.522667-19.776 0-35.712-16.298667-35.712-36.522667z",fill:"#333","p-id":"5882"}})])])])]),e("div",{staticClass:"home-content-input-btns"},[e("el-popover",{attrs:{trigger:"hover",width:"200",placement:"top"},nativeOn:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.$refs.textarea.focus()}}},[e("div",{staticClass:"emoji-grid"},t._l(t.emojiList,(function(i){return e("a",{key:i.icon_id,staticClass:"emoji-grid__item",attrs:{href:"javascript:;"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addEmoji(i)}}},[e("i",{staticClass:"iconfont",class:`icon-${i.font_class}`})])})),0),e("a",{staticClass:"home-content-input-btns__emoji round",attrs:{slot:"reference",href:"javascript:;"},slot:"reference"},[e("svg",{staticClass:"icon",attrs:{t:"1693128544238",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1543",width:"20",height:"20","data-spm-anchor-id":"a313x.search_index.0.i4.5db53a81QDmxwB"}},[e("path",{attrs:{d:"M512 989.866667C249.173333 989.866667 34.133333 774.826667 34.133333 512S249.173333 34.133333 512 34.133333s477.866667 215.04 477.866667 477.866667-215.04 477.866667-477.866667 477.866667z m0-904.533334C276.48 85.333333 85.333333 276.48 85.333333 512s191.146667 426.666667 426.666667 426.666667 426.666667-191.146667 426.666667-426.666667S747.52 85.333333 512 85.333333z",fill:"#333","p-id":"1544"}}),e("path",{attrs:{d:"M512 786.773333c-128 0-179.2-100.693333-180.906667-104.106666-6.826667-11.946667-1.706667-27.306667 11.946667-34.133334 11.946667-6.826667 27.306667-1.706667 34.133333 11.946667 1.706667 3.413333 40.96 76.8 134.826667 76.8 95.573333 0 134.826667-75.093333 134.826667-76.8 6.826667-11.946667 22.186667-17.066667 34.133333-11.946667 11.946667 6.826667 17.066667 22.186667 11.946667 34.133334-1.706667 3.413333-52.906667 104.106667-180.906667 104.106666zM715.093333 447.146667h-90.453333c-13.653333 0-25.6-11.946667-25.6-25.6s11.946667-25.6 25.6-25.6h90.453333c13.653333 0 25.6 11.946667 25.6 25.6s-10.24 25.6-25.6 25.6zM353.28 491.52c-13.653333 0-25.6-11.946667-25.6-25.6V375.466667c0-13.653333 11.946667-25.6 25.6-25.6s25.6 11.946667 25.6 25.6v90.453333c0 15.36-10.24 25.6-25.6 25.6z",fill:"#333","p-id":"1545"}})])])])],1),e("div",{staticClass:"home-content-input-btns"},[e("a",{staticClass:"home-content-input-btns__voice round",class:{"voice-active":"recording"===t.mediaRecorder?.state},attrs:{href:"javascript:;",id:"voice",title:"按住说话"},on:{mousedown:t.recordVoice,mouseup:t.sendVoice,mouseleave:t.cancelVoice,touchstart:t.recordVoice,touchend:t.sendVoice,touchleave:t.cancelVoice}},[e("svg",{staticClass:"icon",attrs:{t:"1690709285923",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2312",width:"20",height:"20"}},[e("path",{attrs:{d:"M256 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z",fill:"#333","p-id":"2313"}}),e("path",{attrs:{d:"M435.7 282.8a31.9 31.9 0 0 0 0 45.2 257.4 257.4 0 0 1 0 368 32 32 0 1 0 44.9 45.6 321.4 321.4 0 0 0 0-459.2 31.9 31.9 0 0 0-44.9 0.4z",fill:"#333","p-id":"2314"}}),e("path",{attrs:{d:"M660.9 105.2a32 32 0 0 0-44.9 45.6 505.2 505.2 0 0 1 0 722.4 32 32 0 1 0 44.9 45.6 569.1 569.1 0 0 0 0-813.6z",fill:"#333","p-id":"2315"}})])])]),e("div",{staticClass:"home-content-input-btns"},[e("button",{staticClass:"round"},[e("label",{attrs:{id:"file-send",for:"chat-file"},on:{click:function(e){t.accept="*"}}},[e("svg",{staticClass:"icon",attrs:{t:"1693141165392",viewBox:"0 0 1260 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"15906",width:"18",height:"18"}},[e("path",{attrs:{d:"M1058.848012 935.688021H88.993243l113.018307-453.124559h969.854769zM88.993243 88.839223h397.403905l52.566655 157.699962h554.052534v147.186632h-893.63312A88.837646 88.837646 0 0 0 115.802237 461.011134l-27.33466 109.338641zM1181.853983 394.251483V246.013518A88.311979 88.311979 0 0 0 1093.016337 157.701539h-490.972549l-31.014326-95.67131A88.311979 88.311979 0 0 0 486.922815 0.001577H88.993243A88.311979 88.311979 0 0 0 0.155598 88.839223V935.688021a88.837646 88.837646 0 0 0 0 10.513331v14.718663a87.260646 87.260646 0 0 0 26.808993 37.847991h5.782332a87.260646 87.260646 0 0 0 39.950657 14.718663h986.150432A88.837646 88.837646 0 0 0 1145.057325 946.201352l113.018307-453.124559a88.837646 88.837646 0 0 0-76.221649-98.82531z",fill:"#333333","p-id":"15907"}})])])])])]),e("div",{staticClass:"tool-right"},[e("div",{staticClass:"home-content-input-btns"},[e("a",{staticClass:"round",staticStyle:{background:"transparent","box-shadow":"none"},attrs:{href:"javascript:;"},on:{click:t.inputDown}},[e("i",{staticClass:"el-icon-arrow-down",style:{transform:t.isDown?"rotate(180deg)":"rotate(0deg)"}})])]),e("div",{staticClass:"home-content-input-btns"},[e("el-popover",{attrs:{trigger:"hover",width:"200",placement:"top"}},[e("ul",{staticClass:"change-enter-list",on:{click:t.changeEnter}},[e("li",{staticClass:"change-enter-item",attrs:{"data-value":"CTRL_ENTER"}},[e("i",{staticClass:"icon",class:{"el-icon-check":"CTRL_ENTER"==t.sendMethod}}),t._v("按住Ctrl+Enter发送")]),e("li",{staticClass:"change-enter-item",attrs:{"data-value":"ENTER"}},[e("i",{staticClass:"icon",class:{"el-icon-check":"ENTER"==t.sendMethod}}),t._v("Enter发送")])]),e("button",{attrs:{slot:"reference",id:"chat-send"},on:{touchstart:function(e){return e.preventDefault(),t.send.apply(null,arguments)},click:t.send,contextmenu:function(t){t.preventDefault(),t.stopPropagation()}},slot:"reference"},[t._v("发送")])])],1)])]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.input,expression:"input"}],ref:"textarea",attrs:{type:"text",id:"chat-input",maxlength:"1000",rows:"1",placeholder:"发送信息"},domProps:{value:t.input},on:{keydown:t.handleKeyDown,input:function(e){e.target.composing||(t.input=e.target.value)}}})]),e("div",{staticClass:"home-content-file",class:{active:t.isDrag}},[e("input",{ref:"upload",attrs:{type:"file",id:"chat-file",accept:t.accept},on:{change:t.uploadFile}})]),t.isChangeAvatar?e("ChangeAvatar",{on:{cancel:t.cancel}}):t._e(),t.file?e("Upload",{attrs:{file:t.file},on:{cancel:t.cancelUpload,confirm:t.confirmUpload}}):t._e()],1)},n=[],a=i(9629),o=i.n(a),r=i(8902),l=i.n(r),c=(i(7658),i(541),function(){var t=this,e=t._self._c;return e("div",{staticClass:"change-avatar"},[e("div",{staticClass:"change-avatar-content"},[e("div",{staticClass:"change-avatar-content-title"},[t._v("更改信息")]),e("div",{staticClass:"change-avatar-content-body"},[e("div",{staticClass:"change-avatar-content-body-item"},[e("div",{staticClass:"change-avatar-content-body-item-title"},[t._v("头像")]),e("div",{staticClass:"change-avatar-content-body-item-content"},[e("div",{staticClass:"change-avatar-content-body-item-content-avatar"},[t.file?e("img",{staticClass:"change-avatar-content-body-item-content-avatar-img",attrs:{src:t.url,alt:"404 Not Found..."},on:{click:t.ResetPhoto}}):e("img",{staticClass:"change-avatar-content-body-item-content-avatar-img",attrs:{src:`https://zeqichat.xyz${t.avatar}`,alt:"404 Not Found..."}})]),e("div",{staticClass:"change-avatar-content-body-item-content-file"},[e("input",{staticClass:"change-avatar-content-body-item-content-file-input",attrs:{type:"file",id:"file",accept:"image/*"},on:{change:t.uploadPhoto}}),e("label",{staticClass:"change-avatar-content-body-item-content-file-label",attrs:{for:"file"}},[t._v("选择图片")])])])]),e("div",{staticClass:"change-avatar-content-body-item"},[e("div",{staticClass:"change-avatar-content-body-item-title"},[t._v("用户名")]),e("div",{staticClass:"change-avatar-content-body-item-content"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"change-avatar-content-body-item-content-input",attrs:{type:"text",placeholder:t.preName},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})])])]),e("div",{staticClass:"change-avatar-content-footer"},[e("div",{staticClass:"change-avatar-content-footer-btn change-avatar-content-footer-btn__cancel",on:{click:t.cancel}},[t._v("取消 ")]),e("div",{staticClass:"change-avatar-content-footer-btn change-avatar-content-footer-btn__confirm",on:{click:t.confirm}},[t._v("确定 ")])])]),t.loading?e("div",{staticClass:"box"},[e("span",[t._v("修改信息中...")]),t._m(0)]):t._e()])}),d=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"loader"},[e("div",{staticClass:"loader__bar"}),e("div",{staticClass:"loader__bar"}),e("div",{staticClass:"loader__bar"}),e("div",{staticClass:"loader__bar"}),e("div",{staticClass:"loader__bar"}),e("div",{staticClass:"loader__ball"})])}],h=i(3822),u={name:"ChangeAvatar",data(){return{loading:!1,file:null,username:""}},computed:{url(){return URL.createObjectURL(this.file)},...(0,h.rn)({avatar:t=>t.user.avatar,preName:t=>t.user.username})},methods:{uploadPhoto(t){this.file=t.target.files[0],t.target.value=""},ResetPhoto(){this.file=null},cancel(){this.$emit("cancel")},async confirm(){if(!this.username)return void this.$notify.error({title:"出错",message:"用户名不能为空",offset:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top"))});this.loading=!0;const t=new FormData;t.append("token",localStorage.getItem("token")),t.append("username",this.username),t.append("avatar",this.file);let e=await this.$axios.put("/api/user",t,{headers:{"Content-Type":"multipart/form-data"}});e.data.ok?(this.$store.commit("SET_USERNAME",e.data.username),this.$store.commit("SET_AVATAR",e.data.avatar),this.$store.commit("SET_TOKEN",e.data.newToken)):this.$notify.error({title:"出错",message:e.data.msg,offset:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top"))}),this.loading=!1,this.$emit("cancel")}},mounted(){this.username=this.preName}},m=u,p=i(1001),f=(0,p.Z)(m,c,d,!1,null,"7e4c7c7c",null),g=f.exports,v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"upload"},[e("div",{staticClass:"upload-content"},[e("div",{staticClass:"upload-content-title"},[t._v("发送"+t._s(t.isImage?"图片":"文件"))]),e("div",{staticClass:"upload-content-msg"},[t._v("你确定要发送"+t._s(t.isImage?"图片":"文件")+"吗？")]),t.isImage?e("div",{staticClass:"upload-content-image"},[e("img",{attrs:{src:t.url}})]):e("div",{staticClass:"upload-content-file"},[e("FileIcon",{attrs:{type:t.suffix}})],1),e("div",{staticClass:"upload-content-file-name"},[t._v(t._s(t.file.name))]),e("div",{staticClass:"upload-content-btns"},[e("button",{staticClass:"upload-content-btns-cancel",on:{click:t.cancel}},[t._v("取消")]),e("button",{staticClass:"upload-content-btns-confirm",on:{click:t.confirm}},[t._v("确定")])])])])},_=[],b={name:"Upload",props:{file:{type:File}},methods:{cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm")}},computed:{isImage(){return this.file.type.includes("image")},url(){return URL.createObjectURL(this.file)},suffix(){return this.file.name.split(".").pop().toLowerCase()},type(){switch(this.suffix){case"doc":case"docx":case"xls":case"xlsx":case"ppt":case"pptx":case"pdf":case"txt":case"zip":case"csv":case"ai":case"psd":case"png":case"jpg":case"jpeg":case"css":case"htm":case"html":case"avi":case"mp4":case"dll":case"waw":case"mp3":case"mp3":case"wav":case"wma":case"aac":case"ogg":case"flac":case"m4a":case"json":case"js":case"jsp":case"ts":case"py":case"md":return this.suffix;default:return"unknown"}}},components:{FileIcon:()=>i.e(93).then(i.bind(i,9093))}},y=b,w=(0,p.Z)(y,v,_,!1,null,"0bc695e6",null),C=w.exports,x=function(){var t=this,e=t._self._c;return e("div",[t.msg.delta>18e4?e("TimeItem",{attrs:{time:t.msg.create_time}}):t._e(),e("MessageItem",{attrs:{msg:t.msg}})],1)},$=[],E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"chat-item",class:"chat-item__"+(t.userId==t.msg.id?"me":"other"),on:{click:t.timeShow}},[e("img",{staticClass:"chat-item-avatar",attrs:{src:`https://zeqichat.xyz${t.msg.avatar}`,alt:"404 Not Found..."},on:{contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.handleContextMenu.apply(null,arguments)},touchstart:function(e){return e.preventDefault(),t.handleLongPressStart("user")},touchend:function(e){return e.preventDefault(),t.handleLongPressEnd("user")}}}),e("div",{staticClass:"chat-item-msg"},[e("div",{staticClass:"chat-item-msg-username",domProps:{innerHTML:t._s(t.filterMessage(t.formatMessage(t.msg.username)))}}),e("div",{staticClass:"chat-item-msg-flex"},[t.msg.isSending?e("button",{staticClass:"chat-item-msg-read"},[e("i",{staticClass:"el-icon-loading"})]):t.to!=t.msg.id&&t.userId==t.msg.id&&t.msg.read_list&&t.msg.read_list.length?e("el-dropdown",{attrs:{trigger:"hover"},on:{command:t.command}},[e("button",{staticClass:"el-dropdown-link",on:{click:function(t){t.stopPropagation()}}},[e("i",{staticClass:"el-icon-view"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.msg.read_list,(function(i){return e("el-dropdown-item",{key:i.id,attrs:{command:i}},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:"https://zeqichat.xyz"+i.avatar}})]),e("div",{staticClass:"username"},[t._v(t._s(i.username))])])})),1)],1):t.to!=t.msg.id&&t.userId==t.msg.id?e("button",{staticClass:"chat-item-msg-read",class:t.msg.to_read?"check":"close"},[e("i",{class:t.msg.to_read?"el-icon-check":"el-icon-close"})]):t._e(),t.msg.recall?e("div",{staticClass:"chat-item-msg-content",on:{contextmenu:function(e){return e.stopPropagation(),e.preventDefault(),t.handleMessageContextMenu.apply(null,arguments)}}},[e("span",{staticClass:"chat-item-msg-message recall"},[t._v("该消息已被撤回")])]):e("div",{ref:"box",staticClass:"chat-item-msg-content",class:{file:t.isFile},on:{contextmenu:function(e){return e.stopPropagation(),e.preventDefault(),t.handleMessageContextMenu.apply(null,arguments)},touchstart:function(e){return e.preventDefault(),t.handleLongPressStart("msg")},touchend:function(e){return e.preventDefault(),t.handleLongPressEnd("msg")}}},[t.isFile?e("a",{attrs:{href:t.url,target:"_blank"}},[e("FileIcon",{attrs:{type:t.type}})],1):t._e(),t.isFile?e("div",{staticClass:"chat-item-msg-message"},[e("div",{staticClass:"content"},[e("a",{attrs:{href:t.url,target:"_blank"}},[t._v(t._s(t.filename))])]),t.isFile?e("div",{staticClass:"tips"},[t._v("该文件/外链安全性未知，请勿随意点击或下载，谨慎操作！")]):t._e()]):e("div",{staticClass:"chat-item-msg-message"},[e("div",{directives:[{name:"highlight",rawName:"v-highlight"}],ref:"message",staticClass:"content",attrs:{id:"message"},domProps:{innerHTML:t._s(t.filterMessage(t.formatMessage(t.msg.message)))},on:{click:function(e){return e.stopPropagation(),t.magic.apply(null,arguments)}}})])])],1),e("el-collapse-transition",[e("div",{directives:[{name:"show",rawName:"v-show",value:t.timeFlag,expression:"timeFlag"}],staticClass:"chat-item-msg-time"},[t._v(" "+t._s(t.formatTime(t.msg.create_time))+" ")])])],1)])},S=[],L=i(4438),T=i.n(L),k=i(6213),D=i.n(k),O=i(4327),M=i.n(O),R=i(3648),j=i(4781),P={name:"ChatItem",data(){return{timeFlag:!1,timer:null,text:null,time:null,pressTimer:null}},components:{[M().name]:M(),[D().name]:D(),[T().name]:T(),FileIcon:()=>i.e(93).then(i.bind(i,9093))},props:{msg:{type:Object,default:()=>{}}},computed:{...(0,h.rn)({username:t=>t.user.username,userId:t=>t.user.userId}),isAudio(){return this.msg.message.startsWith("<audio")},to(){return this.$route.params.id},isFile(){return/^\[.*\]\((.*)\)$/.test(this.msg.message.trim())},type(){return this.msg.suffix?this.msg.suffix:this.msg.message.trim().match(/^\[.*\]\((.*)\)$/)?this.msg.message.trim().match(/^\[.*\]\((.*)\)$/)[1].split(".").pop():null},url(){return this.msg.message.trim().match(/^\[.*\]\((.*)\)$/)?this.msg.message.trim().match(/^\[.*\]\((.*)\)$/)[1]:"javascript:void(0);"},filename(){return this.msg.message.trim().match(/^\[(.*)\]\(.*\)$/)?this.msg.message.trim().match(/^\[(.*)\]\(.*\)$/)[1]:null}},methods:{formatMessage:R.w,filterMessage:R.t,formatTime:j.Z,command(t){this.$bus.$emit("changeUser",t.id)},timeShow(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timeFlag=!0,this.timer=setTimeout((()=>{this.timeFlag=!1,this.timer=null}),2e3)},magic(t){const e=t.target.dataset.type;switch(e){case"firework":this.$bus.$emit("firework",{...t.target.dataset});break;case"audio":this.$bus.$emit("audio",{...t.target.dataset});break}},handleContextMenu(t){const e={x:t.clientX,y:t.clientY,menuList:[{label:"私聊",command:"chat",id:this.msg.id,icon:"el-icon-chat-line-round"},{label:"动态",command:"blog",id:this.msg.id,icon:"el-icon-document"}],isShow:!0};this.userId==this.msg.id&&e.menuList.push({label:"更改信息",command:"changeAvatar",id:this.msg.id,icon:"el-icon-user"}),this.$store.commit("SET_STATE",e)},handleMessageContextMenu(t){const e=[{label:"复制",command:"copy",id:this.msg.msg_id,content:this.msg.message,icon:"el-icon-document-copy",disabled:Boolean(this.msg.recall)},{label:"转发",command:"forward",id:this.msg.id,icon:"el-icon-chat-dot-square",disabled:!0},{label:"删除",command:"delete",id:this.msg.msg_id,icon:"el-icon-delete"},{label:"撤回",command:"recall",id:this.msg.msg_id,icon:"el-icon-refresh-right",disabled:this.msg.id!=this.userId||Boolean(this.msg.recall)}];/^<img.*?src="(.*?)".*?>$/.test(this.msg.message.trim())&&e.push({label:"下载图片",command:"downloadImg",id:this.msg.msg_id,content:this.msg.message.trim().match(/^<img.*?src="(.*?)".*?>$/)[1],icon:"el-icon-picture-outline"});const i={x:t.clientX,y:t.clientY,menuList:e,isShow:!0};this.$store.commit("SET_STATE",i)},handleLongPressStart(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user";this.time=Date.now(),this.pressTimer=setTimeout((()=>{this.handleLongPressEnd(t)}),500)},handleLongPressEnd(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user";clearTimeout(this.pressTimer),this.pressTimer=null;const e=Date.now()-this.time;if(e>500){const e="user"===t?[{label:"私聊",command:"chat",id:this.msg.id,icon:"el-icon-chat-line-round"},{label:"动态",command:"blog",id:this.msg.id,icon:"el-icon-document"}]:[{label:"复制",command:"copy",id:this.msg.msg_id,content:this.msg.message,icon:"el-icon-document-copy",disabled:Boolean(this.msg.recall)},{label:"转发",command:"forward",id:this.msg.id,icon:"el-icon-chat-dot-square",disabled:!0},{label:"删除",command:"delete",id:this.msg.msg_id,icon:"el-icon-delete"},{label:"撤回",command:"recall",id:this.msg.msg_id,icon:"el-icon-refresh-right",disabled:this.msg.id!=this.userId||Boolean(this.msg.recall)}];"user"===t&&this.userId==this.msg.id&&e.push({label:"更改信息",command:"changeAvatar",id:this.msg.id,icon:"el-icon-user"}),this.$store.commit("SET_STATE",{isShow:!0,menuList:e});const i=document.querySelector("#context-menu");i.classList.add("mobile"),setTimeout((()=>{if(i){const t=i.offsetHeight,e=i.offsetWidth,s=this.userId==this.msg.id?this.$refs.box.getBoundingClientRect().x+this.$refs.box.getBoundingClientRect().width-e:this.$refs.box.getBoundingClientRect().x,n=this.$refs.box.getBoundingClientRect().y-5-t;this.$store.commit("SET_STATE",{x:s,y:n})}}))}}},mounted(){this.msg.message?.match(/<audio.*?src="(.+?)"/)&&(this.text=this.msg.message.match(/<audio.*?src="(.*?)"/)?this.msg.message.match(/<audio.*?src="(.*?)"/)[1]:null),this.$bus.$on("audioplay",(t=>{if("https://zeqichat.xyz"+this.text===t||t===this.text)try{this.$refs.message?.querySelector("img")&&(this.$refs.message.querySelector("img").src="https://zeqichat.xyz/images/audio.gif")}catch(e){}else if(this.text)try{this.$refs.message?.querySelector("img")&&(this.$refs.message.querySelector("img").src="https://zeqichat.xyz/images/audio.png")}catch(e){}})),this.$bus.$on("audiopause",(t=>{if("https://zeqichat.xyz"+this.text===t||t===this.text)try{this.$refs.message?.querySelector("img")&&(this.$refs.message.querySelector("img").src="https://zeqichat.xyz/images/audio.png")}catch(e){}}))}},I=P,F=(0,p.Z)(I,E,S,!1,null,"bc5c30a8",null),B=F.exports,A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"time"},[t._v(" "+t._s(t.formatTime(t.time))+" ")])},z=[],N={name:"TimeItem",props:{time:{type:String|Date}},methods:{formatTime:j.Z}},V=N,U=(0,p.Z)(V,A,z,!1,null,"2dc1c1d0",null),H=U.exports,q={name:"ChatItem",components:{MessageItem:B,TimeItem:H},props:{msg:{type:Object,default:()=>{}}}},W=q,Z=(0,p.Z)(W,x,$,!1,null,null,null),K=Z.exports,G=i(7327);class X{constructor(){(0,G.Z)(this,"IsIA",(()=>{const t="object"===typeof window?window.navigator.userAgent:"";return/android/i.test(t)?1:/iPhone|iPod|iPad/i.test(t)?2:void 0})),(0,G.Z)(this,"onResize",(()=>{const t=window.innerHeight;this.originalHeight-t>50?this.show("Android系统: 软键盘弹出"):this.hidden("Android系统: 软键盘收起")})),(0,G.Z)(this,"onFocusin",(()=>{this.show("iOS系统:软键盘弹出")})),(0,G.Z)(this,"onFocusout",(()=>{this.hidden("iOS系统:软键盘收起")})),(0,G.Z)(this,"onStart",(()=>{1==this.type&&window.addEventListener("resize",this.onResize),2==this.type&&(window.addEventListener("focusin",this.onFocusin),window.addEventListener("focusout",this.onFocusout))})),(0,G.Z)(this,"onEnd",(()=>{1==this.type&&window.removeEventListener("resize",this.onResize),2==this.type&&(window.removeEventListener("focusin",this.onFocusin),window.removeEventListener("focusout",this.onFocusout))})),(0,G.Z)(this,"onShow",(t=>{this.show=t})),(0,G.Z)(this,"onHidden",(t=>{this.hidden=t})),this.type=this.IsIA(),this.originalHeight=window.innerHeight}}var Q=X,Y=i(7768),J=i(3819),tt={name:"Chat",components:{ChangeAvatar:g,Upload:C,ChatItem:K,[l().name]:l(),[o().name]:o()},props:{isDrag:{type:Boolean,default:!1},isChangeAvatar:{type:Boolean,default:!1},onlineList:{type:Array,default:()=>[]},friendList:{type:Array,default:()=>[]}},data(){return{msgList:[],input:"",messageEnd:!1,scrollFlag:!1,isRequestData:!1,preHeight:null,WORLD_ID:Y.F,file:null,pageDelta:0,pageNo:0,toAvatar:null,toName:"Loading...",version:2,height:"100%",unread_msg:0,timer:null,mediaRecorder:null,recognition:null,text:"",isFirework:!1,controller:null,audioSrc:"",isAudio:!1,emojiList:J.Z,isDown:!1,accept:"*",sendMethod:localStorage.getItem("sendMethod")||"CTRL_ENTER",isTool:!1}},methods:{addFriend(){this.$bus.$emit("addFriend",this.to)},keyboardEmoji(){alert("请使用手机自带的Emoji键盘发送表情！"),this.$refs.textarea.focus(),this.isTool=!1},changeEnter(t){this.sendMethod=t.target.dataset.value,localStorage.setItem("sendMethod",this.sendMethod)},inputDown(){this.$refs.input.style.height=this.isDown?"200px":"60px",this.isDown=!this.isDown},addEmoji(t){let e=this.$refs.textarea.selectionStart;this.input=this.$refs.textarea.value.slice(0,this.$refs.textarea.selectionStart)+`[${t.name}]`+this.$refs.textarea.value.slice(this.$refs.textarea.selectionEnd),this.$nextTick((()=>{this.$refs.textarea.focus(),this.$refs.textarea.selectionStart=this.$refs.textarea.selectionEnd=e+t.name.length+2,this.fitHeight(this.$refs.textarea)}))},async recordVoice(){const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),e=MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/wav";this.mediaRecorder??(this.mediaRecorder=new MediaRecorder(t,{mimeType:e})),this.mediaRecorder.start();let i="";const s=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition??(this.recognition=new s),this.recognition.lang="zh-CN";try{this.recognition.start()}catch(n){}this.recognition.onresult=t=>{i=t.results[0][0].transcript},this.mediaRecorder.ondataavailable=t=>{const s=new Blob([t.data]),n=new File([s],`${Date.now()}.${e.split("/")[1]}`,{type:e,lastModified:Date.now(),lastModifiedDate:new Date,name:`${Date.now()}.mp3`}),a=Date.now();setTimeout((()=>{const t={message:`<audio src="${URL.createObjectURL(n)}" data-value="${i}"></audio>`,avatar:this.avatar,create_time:a,username:this.username,msg_id:a,recall:!1,id:this.userId,to_read:!1,read_list:[],delta:this.msgList[this.msgList.length-1]?a-new Date(this.msgList[this.msgList.length-1].create_time):1/0,isSending:!0};this.msgList.push(t),this.scrollToBottom(this.$refs.contentList,"smooth")}),1e3);const o=new FormData;o.append("audio",n),this.$axios.post("/api/audio",o,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{setTimeout((()=>{this.to==this.WORLD_ID?this.server.emit(Y.B.GroupChat,this.createMessage(null,`<audio src="${t.data.audio}" data-value="${i}"></audio>`,null,null,null,a)):this.server.emit(Y.B.PrivateChat,this.createMessage(null,`<audio src="${t.data.audio}" data-value="${i}"></audio>`,this.to,null,null,a)),this.pageDelta++,this.mediaRecorder.ondataavailable=null}),1e3)}))}},sendVoice(){this.mediaRecorder&&this.recognition&&(this.recognition.stop(),this.mediaRecorder.stop())},cancelVoice(){this.mediaRecorder&&(this.mediaRecorder.ondataavailable=null,this.mediaRecorder?.stop())},getKeyboardState(){this.monitorKeyboard=new Q,this.monitorKeyboard.onStart(),this.monitorKeyboard.onShow((()=>{})),this.monitorKeyboard.onHidden((()=>{}))},logout(){this.$store.dispatch("logout"),this.server.close(),this.$router.push("/user")},async handleScroll(t){if(t.target.scrollHeight-t.target.scrollTop-t.target.clientHeight<10&&(this.unread_msg=0,this.friendList.length&&this.$emit("changeUnread",this.to,0),this.to==this.WORLD_ID?this.server.emit(Y.B.WorldRead):this.server.emit(Y.B.PrivateRead,this.createMessage(null,null,this.to))),!this.scrollFlag)if(this.messageEnd&&0===t.target.scrollTop)this.scrollFlag=!0,setTimeout((()=>{this.scrollFlag=!1}),1e3);else if(0===t.target.scrollTop){const e=t.target.scrollHeight-t.target.scrollTop;this.to==this.WORLD_ID?await this.getWorldData():await this.getPrivateData(),t.target.scrollTop=t.target.scrollHeight-e}},bubbleClick(){this.scrollToBottom(this.$refs.contentList,"smooth"),this.unread_msg=0,this.friendList.find((t=>t.id==this.to))&&this.$emit("changeUnread",this.to,0),this.to===this.WORLD_ID?this.server.emit(Y.B.WorldRead):this.server.emit(Y.B.PrivateRead,this.createMessage(null,null,this.to))},goBack(){this.$router.replace("/home"),this.$bus.$emit("mobileBack")},cancel(){this.$emit("cancelChangeAvatar")},scrollToBottom(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"instant";this.$nextTick((()=>{t&&t.scrollTo({top:t.scrollHeight,behavior:e})}))},fitHeight(t){if(!this.isMobile)return;t=t.target?t.target:t,t.parentNode.style.height="auto";const e=36;t.parentNode.offsetHeight<e&&(t.parentNode.style.height=e+"px"),t.parentNode.style.height=t.scrollHeight+"px",this.$refs.contentList.scrollTop+this.$refs.contentList.clientHeight+100>=this.$refs.contentList.scrollHeight&&this.scrollToBottom(this.$refs.contentList)},createMessage(t,e,i,s,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Date.now();return{user:t,msg:e,to:i,id:s,msg_id:n,time:a}},handleKeyDown(t){const e=e=>{if(this.sendMethod==e)this.send();else{let e=t.target.selectionStart,i=t.target.selectionEnd,s=t.target.value;this.input=s.substring(0,e)+"\n"+s.substring(i),this.$nextTick((()=>{t.target.selectionStart=t.target.selectionEnd=e+1}))}};if(t.ctrlKey&&"Enter"===t.key)t.preventDefault(),e("CTRL_ENTER");else if("Enter"===t.key)t.preventDefault(),e("ENTER");else if("Tab"===t.key){t.preventDefault();let e=t.target.selectionStart,i=t.target.selectionEnd,s=t.target.value;this.input=s.substring(0,e)+"    "+s.substring(i),this.$nextTick((()=>{t.target.selectionStart=t.target.selectionEnd=e+4}))}this.$nextTick((()=>{this.fitHeight(t),t.target.scroll({top:t.target.scrollHeight})}))},send(){if(!this.to)return;if(!this.input.trim())return void this.$message.warning({message:"发送内容不能为空!",offset:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top"))});const t=Date.now();this.to==this.WORLD_ID?this.server.emit(Y.B.GroupChat,this.createMessage(null,this.input,null,null,null,t)):this.server.emit(Y.B.PrivateChat,this.createMessage(null,this.input,this.to,null,null,t));const e={message:this.input,avatar:this.avatar,create_time:t,username:this.username,msg_id:t,recall:!1,id:this.userId,to_read:!1,read_list:[],delta:this.msgList[this.msgList.length-1]?t-new Date(this.msgList[this.msgList.length-1].create_time):1/0,isSending:!0};this.msgList.push(e),this.scrollToBottom(this.$refs.contentList,"smooth"),this.input="",this.$nextTick((()=>{this.fitHeight(this.$refs.textarea)})),this.pageDelta++},async getWorldData(){this.isRequestData||(this.isRequestData=!0,await this.$axios.get(`/api/chat/world?pageNo=${this.pageNo}&pageDelta=${this.pageDelta}`,{signal:this.controller.signal}).then((t=>{if(!t.data.ok)return void(this.messageEnd=!0);const e=t.data.msg;e.length<20&&(this.messageEnd=!0),this.msgList.unshift(...e);for(let i=0;i<Math.min(e.length+1,this.msgList.length);i++)this.msgList[i].delta=0===i?1/0:new Date(this.msgList[i].create_time)-new Date(this.msgList[i-1].create_time);this.pageNo++,this.isRequestData=!1})).catch((t=>{console.log(t)})))},async getPrivateData(){this.isRequestData||(this.isRequestData=!0,await this.$axios.get(`/api/chat/private?from=${this.token}&to=${this.to}&pageNo=${this.pageNo}&pageDelta=${this.pageDelta}`,{signal:this.controller.signal}).then((t=>{if(!t.data.ok)return void(this.messageEnd=!0);const e=t.data.msg;e.length<20&&(this.messageEnd=!0),this.msgList.unshift(...e);for(let i=0;i<Math.min(e.length+1,this.msgList.length);i++)this.msgList[i].delta=0===i?1/0:new Date(this.msgList[i].create_time)-new Date(this.msgList[i-1].create_time);this.pageNo++,this.isRequestData=!1})).catch((t=>{console.log(t)})))},async toBottom(){await new Promise((t=>{let e=document.querySelectorAll("img"),i=document.querySelectorAll("video"),s=0,n=e.length+i.length;if(0!==n){for(let i=0;i<e.length;i++)e[i].onload=()=>{s++,s===n&&t()};for(let e=0;e<i.length;e++)i[e].onloadeddata=()=>{s++,s===n&&t()}}else t()})),this.scrollToBottom(this.$refs.contentList,"smooth")},bubbleShow(){this.$refs.contentList?.scrollHeight-this.$refs.contentList?.scrollTop-this.$refs.contentList?.clientHeight<100?(this.scrollToBottom(this.$refs.contentList,"smooth"),this.to==this.WORLD_ID?this.server.emit(Y.B.WorldRead):this.server.emit(Y.B.PrivateRead,this.createMessage(null,null,this.to))):(this.unread_msg++,this.$emit("changeUnread",this.to))},async recieveMessage(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.msgList.find((e=>e.create_time===t.time&&e.msg_id===t.time&&e.id==this.userId));if(i)return i.msg_id=t.msg_id,i.isSending=!1,/^\[.*\]\((.*)\)$/.test(t.data.trim())&&(i.message=t.data),void this.$emit("changeFriendlist",this.to,i);const s={message:t.data,avatar:t.avatar,create_time:t.time,username:t.user,msg_id:t.msg_id,recall:!1,id:t.id,to_read:!1,read_list:[],delta:this.msgList[this.msgList.length-1]?t.time-new Date(this.msgList[this.msgList.length-1].create_time):1/0};e?(this.$emit("changeFriendlist",this.WORLD_ID,s),this.to==this.WORLD_ID?(this.msgList.push(s),this.pageDelta++,this.bubbleShow(),this.$emit("changeFriendlist",this.to,i)):(this.$emit("changeUnread",this.WORLD_ID),this.$emit("changeFriendlist",this.to,i))):t.id==this.userId||t.id==this.to?(this.$emit("changeFriendlist",this.to,s),this.msgList.push(s),this.pageDelta++,this.bubbleShow()):(this.$emit("changeFriendlist",t.id,s),this.$emit("changeUnread",t.id))},cancelUpload(){this.file=null,this.$refs.upload.value=null},confirmUpload(){const t=new FormData,e=this.file.type.includes("image")?"image":"file";t.append(e,this.file);const i=Date.now(),s=this.file.name.split(".").pop(),n=this.file.name.replace(`.${s}`,""),a={message:"image"===e?`<img src="${URL.createObjectURL(this.file)}"/>`:`[${n}_${i}.${s}](${URL.createObjectURL(this.file)})`,suffix:s,avatar:this.avatar,create_time:i,username:this.username,msg_id:i,recall:!1,id:this.userId,to_read:!1,read_list:[],delta:this.msgList[this.msgList.length-1]?i-new Date(this.msgList[this.msgList.length-1].create_time):1/0,isSending:!0};this.msgList.push(a),setTimeout((()=>{this.scrollToBottom(this.$refs.contentList,"smooth")})),this.$axios.post("/api/"+e,t,{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{const s="image"===e?`<img src="${t.data.image}"/>`:`[${t.data.file.replace("/uploads/","")}](${"https://zeqichat.xyz"+t.data.file})`;this.to==this.WORLD_ID?this.server.emit(Y.B.GroupChat,this.createMessage(null,s,null,null,null,i)):this.server.emit(Y.B.PrivateChat,this.createMessage(null,s,this.to,null,null,i)),this.$emit("changeFriendlist",this.to,{username:this.username,message:s,avatar:this.avatar}),this.scrollToBottom(this.$refs.contentList,"smooth"),this.pageDelta++})),this.file=null,this.$refs.upload.value=null,this.$nextTick((()=>{this.toBottom()}))},uploadFile(t){const e=t.target.files[0];return!/image\/\w+/.test(e.type)&&this.accept.includes("image")?(this.$notify.warning({title:"警告",message:"请确保文件为图像类型!",offset:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top"))}),t.target.value="",void(this.accept="*")):e.size>5242880?(this.$notify.warning({title:"警告",message:"文件大小不得超过5MB!",offset:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top"))}),t.target.value="",void(this.accept="*")):void(this.file=e)},async init(){this.pageDelta=0,this.pageNo=0,this.msgList=[],this.messageEnd=!1,this.scrollFlag=!1,this.isRequestData=!1,this.mediaRecorder=null,this.recognition=null,this.toAvatar=this.friendList.find((t=>t.id==this.to))?.avatar,this.toName=this.friendList.find((t=>t.id==this.to))?.username,this.getMessage(),this.scrollToBottom(this.$refs.contentList)},filterMessage:R.t,formatMessage:R.w,async getMessage(){this.to==this.WORLD_ID?(this.server.emit(Y.B.WorldRead),await this.getWorldData()):(this.server.emit(Y.B.PrivateRead,this.createMessage(null,null,this.to)),await this.getPrivateData()),this.scrollToBottom(this.$refs.contentList)},openDB(t){},async saveInfo(t){},ended(){this.isAudio=!1,this.$refs.audio?.pause()},play(){this.$bus.$emit("audioplay",this.audioSrc)},pause(){this.$bus.$emit("audiopause",this.audioSrc)}},mounted(){this.$nextTick((()=>{this.$refs.audio&&(this.$refs.audio.oncanplay=t=>{t.target.play(),this.isAudio=!0})}))},created(){this.getKeyboardState(),this.controller?.abort(),this.controller=new AbortController,localStorage.setItem("to",this.to),this.ended(),this.init(),visualViewport.onresize=()=>{this.isMobile?(this.height=visualViewport.height+"px",scrollTo(0,0),setTimeout((()=>{this.scrollToBottom(this.$refs.contentList)}))):this.height="100%"},this.$bus.$on("firework",(t=>{this.text=t.text??"",this.isFirework=!0,setTimeout((()=>{this.isFirework=!1}),3e3)})),this.$bus.$on("audio",(t=>{this.audioSrc===t.src?this.isAudio?(this.$refs.audio?.pause(),this.isAudio=!1):(this.$refs.audio?.play(),this.isAudio=!0):(this.$refs.audio?.pause(),this.audioSrc=t.src)})),this.$bus.$on("recall",(t=>{const e=this.msgList.find((e=>e.msg_id==t));e&&(e.recall=1,this.server.emit(Y.B.Recall,{id:t,to:this.to}))})),this.$bus.$on("delete",(t=>{this.msgList=this.msgList.filter((e=>e.msg_id!=t))})),this.server.on(Y.B.GroupChat,(t=>{this.recieveMessage(t,!0)})),this.server.on(Y.B.PrivateChat,(t=>{this.recieveMessage(t)})),this.server.on(Y.B.WorldRead,(t=>{if(this.to==this.WORLD_ID)for(let e=this.msgList.length-1;e>=0;e--)this.msgList[e].read_list&&(this.msgList[e].read_list?.find((e=>e.id==t.id))||this.msgList[e].read_list.push({id:t.id,username:t.user,avatar:t.avatar}))})),this.server.on(Y.B.PrivateRead,(t=>{if(this.to==t.id)for(let e=this.msgList.length-1;e>=0;e--)this.msgList[e].to_read||this.msgList[e].id==t.user&&(this.msgList[e].to_read=!0)})),this.server.on(Y.B.System,(t=>{t.delta=this.msgList[this.msgList.length-1]?t.time-new Date(this.msgList[this.msgList.length-1].create_time):1/0,this.msgList.push(t),this.scrollToBottom(this.$refs.contentList)})),this.server.on(Y.B.Recall,(t=>{const{id:e,to:i}=t.data;if(i==this.to||i==this.userId){const t=this.msgList.find((t=>t.msg_id==e));if(!t)return;t.recall=!0,t.msg_id==this.msgList[this.msgList.length-1].msg_id?i==this.WORLD_ID?this.$emit("changeFriendlist",this.WORLD_ID,t):i==this.userId?this.$emit("changeFriendlist",this.to,t):this.$emit("changeFriendlist",this.userId,t):this.friendList.find((t=>t.last.msg_id==e))&&this.$emit("changeFriendlist",this.friendList.find((t=>t.last.msg_id==e)).id,{...this.friendList.find((t=>t.last.msg_id==e)).last,recall:!0})}this.$emit("changeFriendlist",this.friendList.find((t=>t.last.msg_id==e)).id,{...this.friendList.find((t=>t.last.msg_id==e)).last,recall:!0})})),this.server.on(Y.B.Error,(()=>{this.$store.dispatch("logout"),this.$router.push("/user")}))},async beforeDestroy(){this.monitorKeyboard?.onEnd(),this.controller?.abort()},computed:{to(){const t=parseInt(this.$route.params.id);return isNaN(t)&&this.$router.replace("/home/chat/"+localStorage.getItem("to")),t},...(0,h.rn)({token:t=>t.user.token,userId:t=>t.user.userId,username:t=>t.user.username,avatar:t=>t.user.avatar,isMobile:t=>t.mobile.isMobile,server:t=>t.server.server}),isFriend(){return this.friendList.find((t=>t.id==this.to))}},watch:{onlineList(){this.toAvatar=this.friendList.find((t=>t.id==this.to))?.avatar??this.avatar,this.toName=this.friendList.find((t=>t.id==this.to))?.username??this.username},friendList(){this.toAvatar=this.friendList.find((t=>t.id==this.to))?.avatar??this.avatar,this.toName=this.friendList.find((t=>t.id==this.to))?.username??this.username},isTool(t){t&&this.$refs.contentList.scrollTop+this.$refs.contentList.clientHeight+100>=this.$refs.contentList.scrollHeight&&this.$nextTick((()=>{this.scrollToBottom(this.$refs.contentList,"smooth"),setTimeout((()=>{this.scrollToBottom(this.$refs.contentList,"smooth")}),500)}))},msgList(t){const e=/^<img src="(.*?)"\/?>$/;t.forEach((t=>{e.test(t.message?.trim())&&(t.message.includes("preview")||(t.message=t.message.replace(e,`<img src="$1" preview="${this.to}"/>`)))})),this.$nextTick((()=>{this.$previewRefresh()}))}}},et=tt,it=(0,p.Z)(et,s,n,!1,null,"2d5f42b2",null),st=it.exports},9358:function(t){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=97)}({0:function(t,e,i){"use strict";function s(t,e,i,s,n,a,o,r){var l,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),s&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),o?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):n&&(l=r?function(){n.call(this,this.$root.$options.shadowRoot)}:n),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}i.d(e,"a",(function(){return s}))},97:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"el-button-group"},[t._t("default")],2)},n=[];s._withStripped=!0;var a={name:"ElButtonGroup"},o=a,r=i(0),l=Object(r["a"])(o,s,n,!1,null,null,null);l.options.__file="packages/button/src/button-group.vue";var c=l.exports;c.install=function(t){t.component(c.name,c)};e["default"]=c}})},4438:function(t,e,i){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=84)}({0:function(t,e,i){"use strict";function s(t,e,i,s,n,a,o,r){var l,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),s&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),o?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):n&&(l=r?function(){n.call(this,this.$root.$options.shadowRoot)}:n),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}i.d(e,"a",(function(){return s}))},4:function(t,e){t.exports=i(8816)},84:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{staticClass:"el-dropdown-menu__item",class:{"is-disabled":t.disabled,"el-dropdown-menu__item--divided":t.divided},attrs:{"aria-disabled":t.disabled,tabindex:t.disabled?null:-1},on:{click:t.handleClick}},[t.icon?i("i",{class:t.icon}):t._e(),t._t("default")],2)},n=[];s._withStripped=!0;var a=i(4),o=i.n(a),r={name:"ElDropdownItem",mixins:[o.a],props:{command:{},disabled:Boolean,divided:Boolean,icon:String},methods:{handleClick:function(t){this.dispatch("ElDropdown","menu-item-click",[this.command,this])}}},l=r,c=i(0),d=Object(c["a"])(l,s,n,!1,null,null,null);d.options.__file="packages/dropdown/src/dropdown-item.vue";var h=d.exports;h.install=function(t){t.component(h.name,h)};e["default"]=h}})},6213:function(t,e,i){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=83)}({0:function(t,e,i){"use strict";function s(t,e,i,s,n,a,o,r){var l,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),s&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),o?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):n&&(l=r?function(){n.call(this,this.$root.$options.shadowRoot)}:n),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}i.d(e,"a",(function(){return s}))},5:function(t,e){t.exports=i(4857)},83:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"el-zoom-in-top"},on:{"after-leave":t.doDestroy}},[i("ul",{directives:[{name:"show",rawName:"v-show",value:t.showPopper,expression:"showPopper"}],staticClass:"el-dropdown-menu el-popper",class:[t.size&&"el-dropdown-menu--"+t.size]},[t._t("default")],2)])},n=[];s._withStripped=!0;var a=i(5),o=i.n(a),r={name:"ElDropdownMenu",componentName:"ElDropdownMenu",mixins:[o.a],props:{visibleArrow:{type:Boolean,default:!0},arrowOffset:{type:Number,default:0}},data:function(){return{size:this.dropdown.dropdownSize}},inject:["dropdown"],created:function(){var t=this;this.$on("updatePopper",(function(){t.showPopper&&t.updatePopper()})),this.$on("visible",(function(e){t.showPopper=e}))},mounted:function(){this.dropdown.popperElm=this.popperElm=this.$el,this.referenceElm=this.dropdown.$el,this.dropdown.initDomOperation()},watch:{"dropdown.placement":{immediate:!0,handler:function(t){this.currentPlacement=t}}}},l=r,c=i(0),d=Object(c["a"])(l,s,n,!1,null,null,null);d.options.__file="packages/dropdown/src/dropdown-menu.vue";var h=d.exports;h.install=function(t){t.component(h.name,h)};e["default"]=h}})},4327:function(t,e,i){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=130)}({0:function(t,e,i){"use strict";function s(t,e,i,s,n,a,o,r){var l,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),s&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),o?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):n&&(l=r?function(){n.call(this,this.$root.$options.shadowRoot)}:n),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}i.d(e,"a",(function(){return s}))},11:function(t,e){t.exports=i(4511)},12:function(t,e){t.exports=i(9305)},130:function(t,e,i){"use strict";i.r(e);var s,n,a=i(12),o=i.n(a),r=i(4),l=i.n(r),c=i(11),d=i.n(c),h=i(14),u=i.n(h),m=i(36),p=i.n(m),f=i(3),g={name:"ElDropdown",componentName:"ElDropdown",mixins:[l.a,d.a],directives:{Clickoutside:o.a},components:{ElButton:u.a,ElButtonGroup:p.a},provide:function(){return{dropdown:this}},props:{trigger:{type:String,default:"hover"},type:String,size:{type:String,default:""},splitButton:Boolean,hideOnClick:{type:Boolean,default:!0},placement:{type:String,default:"bottom-end"},visibleArrow:{default:!0},showTimeout:{type:Number,default:250},hideTimeout:{type:Number,default:150},tabindex:{type:Number,default:0},disabled:{type:Boolean,default:!1}},data:function(){return{timeout:null,visible:!1,triggerElm:null,menuItems:null,menuItemsArray:null,dropdownElm:null,focusing:!1,listId:"dropdown-menu-"+Object(f["generateId"])()}},computed:{dropdownSize:function(){return this.size||(this.$ELEMENT||{}).size}},mounted:function(){this.$on("menu-item-click",this.handleMenuItemClick)},watch:{visible:function(t){this.broadcast("ElDropdownMenu","visible",t),this.$emit("visible-change",t)},focusing:function(t){var e=this.$el.querySelector(".el-dropdown-selfdefine");e&&(t?e.className+=" focusing":e.className=e.className.replace("focusing",""))}},methods:{getMigratingConfig:function(){return{props:{"menu-align":"menu-align is renamed to placement."}}},show:function(){var t=this;this.disabled||(clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.visible=!0}),"click"===this.trigger?0:this.showTimeout))},hide:function(){var t=this;this.disabled||(this.removeTabindex(),this.tabindex>=0&&this.resetTabindex(this.triggerElm),clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.visible=!1}),"click"===this.trigger?0:this.hideTimeout))},handleClick:function(){this.disabled||(this.visible?this.hide():this.show())},handleTriggerKeyDown:function(t){var e=t.keyCode;[38,40].indexOf(e)>-1?(this.removeTabindex(),this.resetTabindex(this.menuItems[0]),this.menuItems[0].focus(),t.preventDefault(),t.stopPropagation()):13===e?this.handleClick():[9,27].indexOf(e)>-1&&this.hide()},handleItemKeyDown:function(t){var e=t.keyCode,i=t.target,s=this.menuItemsArray.indexOf(i),n=this.menuItemsArray.length-1,a=void 0;[38,40].indexOf(e)>-1?(a=38===e?0!==s?s-1:0:s<n?s+1:n,this.removeTabindex(),this.resetTabindex(this.menuItems[a]),this.menuItems[a].focus(),t.preventDefault(),t.stopPropagation()):13===e?(this.triggerElmFocus(),i.click(),this.hideOnClick&&(this.visible=!1)):[9,27].indexOf(e)>-1&&(this.hide(),this.triggerElmFocus())},resetTabindex:function(t){this.removeTabindex(),t.setAttribute("tabindex","0")},removeTabindex:function(){this.triggerElm.setAttribute("tabindex","-1"),this.menuItemsArray.forEach((function(t){t.setAttribute("tabindex","-1")}))},initAria:function(){this.dropdownElm.setAttribute("id",this.listId),this.triggerElm.setAttribute("aria-haspopup","list"),this.triggerElm.setAttribute("aria-controls",this.listId),this.splitButton||(this.triggerElm.setAttribute("role","button"),this.triggerElm.setAttribute("tabindex",this.tabindex),this.triggerElm.setAttribute("class",(this.triggerElm.getAttribute("class")||"")+" el-dropdown-selfdefine"))},initEvent:function(){var t=this,e=this.trigger,i=this.show,s=this.hide,n=this.handleClick,a=this.splitButton,o=this.handleTriggerKeyDown,r=this.handleItemKeyDown;this.triggerElm=a?this.$refs.trigger.$el:this.$slots.default[0].elm;var l=this.dropdownElm;this.triggerElm.addEventListener("keydown",o),l.addEventListener("keydown",r,!0),a||(this.triggerElm.addEventListener("focus",(function(){t.focusing=!0})),this.triggerElm.addEventListener("blur",(function(){t.focusing=!1})),this.triggerElm.addEventListener("click",(function(){t.focusing=!1}))),"hover"===e?(this.triggerElm.addEventListener("mouseenter",i),this.triggerElm.addEventListener("mouseleave",s),l.addEventListener("mouseenter",i),l.addEventListener("mouseleave",s)):"click"===e&&this.triggerElm.addEventListener("click",n)},handleMenuItemClick:function(t,e){this.hideOnClick&&(this.visible=!1),this.$emit("command",t,e)},triggerElmFocus:function(){this.triggerElm.focus&&this.triggerElm.focus()},initDomOperation:function(){this.dropdownElm=this.popperElm,this.menuItems=this.dropdownElm.querySelectorAll("[tabindex='-1']"),this.menuItemsArray=[].slice.call(this.menuItems),this.initEvent(),this.initAria()}},render:function(t){var e=this,i=this.hide,s=this.splitButton,n=this.type,a=this.dropdownSize,o=this.disabled,r=function(t){e.$emit("click",t),i()},l=null;if(s)l=t("el-button-group",[t("el-button",{attrs:{type:n,size:a,disabled:o},nativeOn:{click:r}},[this.$slots.default]),t("el-button",{ref:"trigger",attrs:{type:n,size:a,disabled:o},class:"el-dropdown__caret-button"},[t("i",{class:"el-dropdown__icon el-icon-arrow-down"})])]);else{l=this.$slots.default;var c=l[0].data||{},d=c.attrs,h=void 0===d?{}:d;o&&!h.disabled&&(h.disabled=!0,c.attrs=h)}var u=o?null:this.$slots.dropdown;return t("div",{class:"el-dropdown",directives:[{name:"clickoutside",value:i}],attrs:{"aria-disabled":o}},[l,u])}},v=g,_=i(0),b=Object(_["a"])(v,s,n,!1,null,null,null);b.options.__file="packages/dropdown/src/dropdown.vue";var y=b.exports;y.install=function(t){t.component(y.name,y)};e["default"]=y},14:function(t,e){t.exports=i(1540)},3:function(t,e){t.exports=i(5402)},36:function(t,e){t.exports=i(9358)},4:function(t,e){t.exports=i(8816)}})},9629:function(t,e,i){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=69)}({0:function(t,e,i){"use strict";function s(t,e,i,s,n,a,o,r){var l,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),s&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),o?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):n&&(l=r?function(){n.call(this,this.$root.$options.shadowRoot)}:n),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}i.d(e,"a",(function(){return s}))},20:function(t,e){t.exports=i(4582)},69:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"el-empty"},[i("div",{staticClass:"el-empty__image",style:t.imageStyle},[t.image?i("img",{attrs:{src:t.image,ondragstart:"return false"}}):t._t("image",[i("img-empty")])],2),i("div",{staticClass:"el-empty__description"},[t.$slots.description?t._t("description"):i("p",[t._v(t._s(t.emptyDescription))])],2),t.$slots.default?i("div",{staticClass:"el-empty__bottom"},[t._t("default")],2):t._e()])},n=[];s._withStripped=!0;var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("svg",{attrs:{viewBox:"0 0 79 86",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[i("defs",[i("linearGradient",{attrs:{id:"linearGradient-1-"+t.id,x1:"38.8503086%",y1:"0%",x2:"61.1496914%",y2:"100%"}},[i("stop",{attrs:{"stop-color":"#FCFCFD",offset:"0%"}}),i("stop",{attrs:{"stop-color":"#EEEFF3",offset:"100%"}})],1),i("linearGradient",{attrs:{id:"linearGradient-2-"+t.id,x1:"0%",y1:"9.5%",x2:"100%",y2:"90.5%"}},[i("stop",{attrs:{"stop-color":"#FCFCFD",offset:"0%"}}),i("stop",{attrs:{"stop-color":"#E9EBEF",offset:"100%"}})],1),i("rect",{attrs:{id:"path-3-"+t.id,x:"0",y:"0",width:"17",height:"36"}})],1),i("g",{attrs:{id:"Illustrations",stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"}},[i("g",{attrs:{id:"B-type",transform:"translate(-1268.000000, -535.000000)"}},[i("g",{attrs:{id:"Group-2",transform:"translate(1268.000000, 535.000000)"}},[i("path",{attrs:{id:"Oval-Copy-2",d:"M39.5,86 C61.3152476,86 79,83.9106622 79,81.3333333 C79,78.7560045 57.3152476,78 35.5,78 C13.6847524,78 0,78.7560045 0,81.3333333 C0,83.9106622 17.6847524,86 39.5,86 Z",fill:"#F7F8FC"}}),i("polygon",{attrs:{id:"Rectangle-Copy-14",fill:"#E5E7E9",transform:"translate(27.500000, 51.500000) scale(1, -1) translate(-27.500000, -51.500000) ",points:"13 58 53 58 42 45 2 45"}}),i("g",{attrs:{id:"Group-Copy",transform:"translate(34.500000, 31.500000) scale(-1, 1) rotate(-25.000000) translate(-34.500000, -31.500000) translate(7.000000, 10.000000)"}},[i("polygon",{attrs:{id:"Rectangle-Copy-10",fill:"#E5E7E9",transform:"translate(11.500000, 5.000000) scale(1, -1) translate(-11.500000, -5.000000) ",points:"2.84078316e-14 3 18 3 23 7 5 7"}}),i("polygon",{attrs:{id:"Rectangle-Copy-11",fill:"#EDEEF2",points:"-3.69149156e-15 7 38 7 38 43 -3.69149156e-15 43"}}),i("rect",{attrs:{id:"Rectangle-Copy-12",fill:"url(#linearGradient-1-"+t.id+")",transform:"translate(46.500000, 25.000000) scale(-1, 1) translate(-46.500000, -25.000000) ",x:"38",y:"7",width:"17",height:"36"}}),i("polygon",{attrs:{id:"Rectangle-Copy-13",fill:"#F8F9FB",transform:"translate(39.500000, 3.500000) scale(-1, 1) translate(-39.500000, -3.500000) ",points:"24 7 41 7 55 -3.63806207e-12 38 -3.63806207e-12"}})]),i("rect",{attrs:{id:"Rectangle-Copy-15",fill:"url(#linearGradient-2-"+t.id+")",x:"13",y:"45",width:"40",height:"36"}}),i("g",{attrs:{id:"Rectangle-Copy-17",transform:"translate(53.000000, 45.000000)"}},[i("mask",{attrs:{id:"mask-4-"+t.id,fill:"white"}},[i("use",{attrs:{"xlink:href":"#path-3-"+t.id}})]),i("use",{attrs:{id:"Mask",fill:"#E0E3E9",transform:"translate(8.500000, 18.000000) scale(-1, 1) translate(-8.500000, -18.000000) ","xlink:href":"#path-3-"+t.id}}),i("polygon",{attrs:{id:"Rectangle-Copy",fill:"#D5D7DE",mask:"url(#mask-4-"+t.id+")",transform:"translate(12.000000, 9.000000) scale(-1, 1) translate(-12.000000, -9.000000) ",points:"7 0 24 0 20 18 -1.70530257e-13 16"}})]),i("polygon",{attrs:{id:"Rectangle-Copy-18",fill:"#F8F9FB",transform:"translate(66.000000, 51.500000) scale(-1, 1) translate(-66.000000, -51.500000) ",points:"62 45 79 45 70 58 53 58"}})])])])])},o=[];a._withStripped=!0;var r=0,l={name:"ImgEmpty",data:function(){return{id:++r}}},c=l,d=i(0),h=Object(d["a"])(c,a,o,!1,null,null,null);h.options.__file="packages/empty/src/img-empty.vue";var u,m=h.exports,p=i(20),f={name:"ElEmpty",components:(u={},u[m.name]=m,u),props:{image:{type:String,default:""},imageSize:Number,description:{type:String,default:""}},computed:{emptyDescription:function(){return this.description||Object(p["t"])("el.empty.description")},imageStyle:function(){return{width:this.imageSize?this.imageSize+"px":""}}}},g=f,v=Object(d["a"])(g,s,n,!1,null,null,null);v.options.__file="packages/empty/src/index.vue";var _=v.exports;_.install=function(t){t.component(_.name,_)};e["default"]=_}})},8902:function(t,e,i){t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=78)}({0:function(t,e,i){"use strict";function s(t,e,i,s,n,a,o,r){var l,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),s&&(c.functional=!0),a&&(c._scopeId="data-v-"+a),o?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):n&&(l=r?function(){n.call(this,this.$root.$options.shadowRoot)}:n),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(t,e){return l.call(e),d(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}i.d(e,"a",(function(){return s}))},2:function(t,e){t.exports=i(3766)},3:function(t,e){t.exports=i(5402)},5:function(t,e){t.exports=i(4857)},7:function(t,e){t.exports=i(6369)},78:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",[i("transition",{attrs:{name:t.transition},on:{"after-enter":t.handleAfterEnter,"after-leave":t.handleAfterLeave}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.disabled&&t.showPopper,expression:"!disabled && showPopper"}],ref:"popper",staticClass:"el-popover el-popper",class:[t.popperClass,t.content&&"el-popover--plain"],style:{width:t.width+"px"},attrs:{role:"tooltip",id:t.tooltipId,"aria-hidden":t.disabled||!t.showPopper?"true":"false"}},[t.title?i("div",{staticClass:"el-popover__title",domProps:{textContent:t._s(t.title)}}):t._e(),t._t("default",[t._v(t._s(t.content))])],2)]),i("span",{ref:"wrapper",staticClass:"el-popover__reference-wrapper"},[t._t("reference")],2)],1)},n=[];s._withStripped=!0;var a=i(5),o=i.n(a),r=i(2),l=i(3),c={name:"ElPopover",mixins:[o.a],props:{trigger:{type:String,default:"click",validator:function(t){return["click","focus","hover","manual"].indexOf(t)>-1}},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:200},title:String,disabled:Boolean,content:String,reference:{},popperClass:String,width:{},visibleArrow:{default:!0},arrowOffset:{type:Number,default:0},transition:{type:String,default:"fade-in-linear"},tabindex:{type:Number,default:0}},computed:{tooltipId:function(){return"el-popover-"+Object(l["generateId"])()}},watch:{showPopper:function(t){this.disabled||(t?this.$emit("show"):this.$emit("hide"))}},mounted:function(){var t=this,e=this.referenceElm=this.reference||this.$refs.reference,i=this.popper||this.$refs.popper;!e&&this.$refs.wrapper.children&&(e=this.referenceElm=this.$refs.wrapper.children[0]),e&&(Object(r["addClass"])(e,"el-popover__reference"),e.setAttribute("aria-describedby",this.tooltipId),e.setAttribute("tabindex",this.tabindex),i.setAttribute("tabindex",0),"click"!==this.trigger&&(Object(r["on"])(e,"focusin",(function(){t.handleFocus();var i=e.__vue__;i&&"function"===typeof i.focus&&i.focus()})),Object(r["on"])(i,"focusin",this.handleFocus),Object(r["on"])(e,"focusout",this.handleBlur),Object(r["on"])(i,"focusout",this.handleBlur)),Object(r["on"])(e,"keydown",this.handleKeydown),Object(r["on"])(e,"click",this.handleClick)),"click"===this.trigger?(Object(r["on"])(e,"click",this.doToggle),Object(r["on"])(document,"click",this.handleDocumentClick)):"hover"===this.trigger?(Object(r["on"])(e,"mouseenter",this.handleMouseEnter),Object(r["on"])(i,"mouseenter",this.handleMouseEnter),Object(r["on"])(e,"mouseleave",this.handleMouseLeave),Object(r["on"])(i,"mouseleave",this.handleMouseLeave)):"focus"===this.trigger&&(this.tabindex<0&&console.warn("[Element Warn][Popover]a negative taindex means that the element cannot be focused by tab key"),e.querySelector("input, textarea")?(Object(r["on"])(e,"focusin",this.doShow),Object(r["on"])(e,"focusout",this.doClose)):(Object(r["on"])(e,"mousedown",this.doShow),Object(r["on"])(e,"mouseup",this.doClose)))},beforeDestroy:function(){this.cleanup()},deactivated:function(){this.cleanup()},methods:{doToggle:function(){this.showPopper=!this.showPopper},doShow:function(){this.showPopper=!0},doClose:function(){this.showPopper=!1},handleFocus:function(){Object(r["addClass"])(this.referenceElm,"focusing"),"click"!==this.trigger&&"focus"!==this.trigger||(this.showPopper=!0)},handleClick:function(){Object(r["removeClass"])(this.referenceElm,"focusing")},handleBlur:function(){Object(r["removeClass"])(this.referenceElm,"focusing"),"click"!==this.trigger&&"focus"!==this.trigger||(this.showPopper=!1)},handleMouseEnter:function(){var t=this;clearTimeout(this._timer),this.openDelay?this._timer=setTimeout((function(){t.showPopper=!0}),this.openDelay):this.showPopper=!0},handleKeydown:function(t){27===t.keyCode&&"manual"!==this.trigger&&this.doClose()},handleMouseLeave:function(){var t=this;clearTimeout(this._timer),this.closeDelay?this._timer=setTimeout((function(){t.showPopper=!1}),this.closeDelay):this.showPopper=!1},handleDocumentClick:function(t){var e=this.reference||this.$refs.reference,i=this.popper||this.$refs.popper;!e&&this.$refs.wrapper.children&&(e=this.referenceElm=this.$refs.wrapper.children[0]),this.$el&&e&&!this.$el.contains(t.target)&&!e.contains(t.target)&&i&&!i.contains(t.target)&&(this.showPopper=!1)},handleAfterEnter:function(){this.$emit("after-enter")},handleAfterLeave:function(){this.$emit("after-leave"),this.doDestroy()},cleanup:function(){(this.openDelay||this.closeDelay)&&clearTimeout(this._timer)}},destroyed:function(){var t=this.reference;Object(r["off"])(t,"click",this.doToggle),Object(r["off"])(t,"mouseup",this.doClose),Object(r["off"])(t,"mousedown",this.doShow),Object(r["off"])(t,"focusin",this.doShow),Object(r["off"])(t,"focusout",this.doClose),Object(r["off"])(t,"mousedown",this.doShow),Object(r["off"])(t,"mouseup",this.doClose),Object(r["off"])(t,"mouseleave",this.handleMouseLeave),Object(r["off"])(t,"mouseenter",this.handleMouseEnter),Object(r["off"])(document,"click",this.handleDocumentClick)}},d=c,h=i(0),u=Object(h["a"])(d,s,n,!1,null,null,null);u.options.__file="packages/popover/src/main.vue";var m=u.exports,p=function(t,e,i){var s=e.expression?e.value:e.arg,n=i.context.$refs[s];n&&(Array.isArray(n)?n[0].$refs.reference=t:n.$refs.reference=t)},f={bind:function(t,e,i){p(t,e,i)},inserted:function(t,e,i){p(t,e,i)}},g=i(7),v=i.n(g);v.a.directive("popover",f),m.install=function(t){t.directive("popover",f),t.component(m.name,m)},m.directive=f;e["default"]=m}})}}]);