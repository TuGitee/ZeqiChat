"use strict";(self["webpackChunkchat"]=self["webpackChunkchat"]||[]).push([[183],{183:function(e,t,s){s.r(t),s.d(t,{default:function(){return y}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login"},[e.isMobile?e._e():t("angry-face",{ref:"face"}),t("div",{staticClass:"login-box"},[t("h1",{staticClass:"login-box-title no-select"},[e._v("登录")]),e.isMobile?e._e():t("p",{staticClass:"no-account no-select"},[t("i",{staticClass:"el-icon-warning-outline"}),e._v(" 没有账号? "),t("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.$emit("changeChoice")}}},[e._v("点我注册")])]),t("el-form",{ref:"Form",attrs:{"label-position":"right","label-width":"max-content",model:e.form,rules:e.rules,"show-message":!1},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login.apply(null,arguments)}}},[t("el-form-item",{attrs:{prop:"email",label:e.isMobile?"":"邮箱"}},[t("el-input",{attrs:{type:"email",placeholder:"请输入邮箱"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e.isPassword?t("el-form-item",{attrs:{prop:"password",label:e.isMobile?"":"密码"}},[t("el-input",{attrs:{type:e.show?"text":"password",clearable:"",placeholder:"请输入密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}},[t("i",{staticClass:"el-icon-view",class:{hidden:!e.show},attrs:{slot:"prefix"},on:{click:function(t){e.show=!e.show}},slot:"prefix"})])],1):t("el-form-item",{attrs:{prop:"captcha",label:e.isMobile?"":"验证码"}},[t("el-input",{model:{value:e.form.captcha,callback:function(t){e.$set(e.form,"captcha",t)},expression:"form.captcha"}},[t("el-button",{attrs:{slot:"append",type:"button",disabled:e.seconds>=0},on:{click:function(t){return t.preventDefault(),e.getCaptcha.apply(null,arguments)}},slot:"append"},[e._v(e._s(e.seconds>=0?`重新发送(${e.seconds}s)`:"获取验证码"))])],1)],1),t("el-form-item",{attrs:{prop:"protocol",required:""}},[t("el-checkbox",{attrs:{label:"protocol"},model:{value:e.form.protocol,callback:function(t){e.$set(e.form,"protocol",t)},expression:"form.protocol"}},[e._v("您已阅读并同意"),t("a",{attrs:{href:"https://tugitee.github.io/ZeqiChat/protocol",target:"_blank"}},[e._v("择栖Chat服务协议")])])],1),t("el-form-item",[e.isMobile?e._e():t("el-button",{on:{click:function(t){e.isPassword=!e.isPassword}}},[e._v(e._s(e.isPassword?"使用验证码登录":"使用密码登录"))]),e.isMobile?t("div",{staticClass:"tool"},[t("p",{staticClass:"another-method",on:{click:function(t){e.isPassword=!e.isPassword}}},[e._v(e._s(e.isPassword?"使用验证码登录":"使用密码登录"))]),t("p",{staticClass:"no-account"},[t("i",{staticClass:"el-icon-warning-outline"}),e._v(" 没有账号? "),t("a",{on:{click:function(t){return e.$emit("changeChoice")}}},[e._v("点我注册")])])]):e._e(),t("el-button",{staticClass:"form-button",attrs:{type:"primary",id:"login"},on:{click:e.login}},[e._v("登录")])],1)],1)],1)],1)},a=[],i=s(4359),r=s.n(i),l=s(1168),n=s.n(l),c=s(1540),m=s.n(c),p=s(8319),u=s.n(p),d=s(5981),h=s.n(d),f=(s(7658),s(3822)),g={name:"Login",data(){return{form:{email:"",password:"",captcha:"",protocol:["protocol"]},isPassword:!0,seconds:-1,timer:null,angerTimer:null,show:!1}},methods:{login(){this.$refs.Form.validate(((e,t)=>{if(!e)return this.$notify.warning({title:"警告",dangerouslyUseHTMLString:!0,message:"<li>"+Object.entries(t).map((e=>{let[t,s]=e;return s.map((e=>e.message)).join(", ")})).join("</li><li>")+"</li>",offset:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top"))}),void this.$refs.face.handleError();{const e=this.isPassword?{email:this.form.email,password:this.form.password}:{email:this.form.email,captcha:this.form.captcha};this.$axios.post("/api/login",e).then((e=>{1===e.data.ok?(localStorage.setItem("token",e.data.token),this.$router.push("/home")):(this.$notify.error({title:"出错",message:e.data.msg,offset:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top"))}),this.$refs.face.handleError())})).catch((e=>{this.$refs.face.handleError(),console.log(e)}))}}))},getCaptcha(){const e=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;if(!e.test(this.form.email))return this.$notify.warning({title:"警告",message:"邮箱格式不正确",offset:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top"))}),void this.$refs.face.handleError();this.seconds=60,this.timer=setInterval((()=>{this.seconds<0?clearInterval(this.timer):this.seconds--}),1e3),this.$axios.get(`/api/login?email=${this.form.email}`)}},components:{[h().name]:h(),[u().name]:u(),[m().name]:m(),[n().name]:n(),[r().name]:r(),AngryFace:()=>s.e(107).then(s.bind(s,2107))},computed:{rules(){return{email:[{required:!0,message:"请输入邮箱",trigger:"change"},{type:this.isPassword?"string":"email",message:this.isPassword?"请输入正确的邮箱/用户名":"请输入正确的邮箱地址",trigger:["blur","change"]}],password:[{required:this.isPassword,message:"请输入密码",trigger:"blur"}],captcha:[{required:!this.isPassword,message:"请输入验证码",trigger:"blur"},{min:6,max:6,message:"请输入6位验证码",trigger:["blur","change"]}],protocol:[{type:"array",required:!0,message:"请勾选同意协议",trigger:"change"}]}},...(0,f.rn)({isMobile:e=>e.mobile.isMobile})}},w=g,b=s(1001),v=(0,b.Z)(w,o,a,!1,null,"4e08524a",null),y=v.exports}}]);