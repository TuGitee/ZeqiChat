"use strict";(self["webpackChunkchat"]=self["webpackChunkchat"]||[]).push([[680],{9680:function(t,e,s){s.r(e),s.d(e,{default:function(){return C}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"blog"},[e("div",{ref:"blogItem",staticClass:"blog-item"},[e("div",{staticClass:"blog-item-header"},[e("div",{staticClass:"blog-item-header-content"},[e("div",{staticClass:"blog-item-header-avatar",on:{contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.handleContextMenu.apply(null,arguments)}}},[e("router-link",{attrs:{to:{name:"blog",params:{id:t.blog.id}},replace:""}},[e("img",{attrs:{src:`https://zeqichat.xyz${t.blog.avatar}`,alt:""}})])],1),e("div",{staticClass:"blog-item-header-info"},[e("router-link",{attrs:{to:{name:"blog",params:{id:t.blog.id}},replace:""}},[e("div",{staticClass:"blog-item-header-info-name"},[t._v(" "+t._s(t.blog.username)+" ")])]),e("div",{staticClass:"blog-item-header-info-time"},[t._v(" "+t._s(t.formatTime(t.blog.create_time))+" ")])],1)]),e("div",{staticClass:"blog-item-header-tool"},[t.blog.username==t.username?e("button",{staticClass:"blog-item-header-tool-delete",on:{click:t.deleteBlog}},[t._v("删除")]):t._e(),t.blog.commentList.length?e("button",{staticClass:"blog-item-header-tool-collapse",on:{click:t.collapse}},[t._v(t._s(t.isCollapse?"展开":"折叠"))]):t._e()])]),e("div",{staticClass:"blog-item-content"},[e("div",{staticClass:"blog-item-content-text",domProps:{innerHTML:t._s(t.filterMessage(t.formatMessage(t.blog.content)))}}),t.imageList.length?e("ul",{staticClass:"blog-item-content-img"},t._l(t.imageList,(function(s,i){return e("li",{key:i,staticClass:"blog-item-content-img-item"},[e("img",{attrs:{src:s,preview:t.blog.blog_id}})])})),0):t._e()]),e("div",{staticClass:"blog-item-footer"},[e("router-link",{attrs:{to:{name:"blog",params:{id:t.userId}},replace:""}},[e("img",{staticClass:"blog-item-footer-avatar",attrs:{src:`https://zeqichat.xyz${t.avatar}`,alt:""}})]),e("form",{staticClass:"blog-item-footer-form",attrs:{action:"#"},on:{submit:function(e){return e.preventDefault(),t.commentBlog.apply(null,arguments)}}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.comment,expression:"comment"}],staticClass:"blog-item-footer-form-input",attrs:{type:"text",placeholder:"说点什么...",disabled:t.isRequest},domProps:{value:t.comment},on:{input:function(e){e.target.composing||(t.comment=e.target.value)}}}),e("button",{staticClass:"blog-item-footer-form-button",attrs:{disabled:t.isRequest}},[t.isRequest?e("i",{staticClass:"el-icon-loading"}):t._e(),t._v("评论")])])],1)]),e("DrawerTransition",[t.blog.commentList.length&&!t.isCollapse?e("div",{staticClass:"blog-comment"},[e("div",{staticClass:"blog-comment-title"},[e("span",[t._v("评论")])]),e("ul",{staticClass:"blog-comment-list",style:{maxHeight:t.height}},[t._l(t.blog.commentList.slice(0,t.last),(function(s){return e("li",{key:s.comment_id,staticClass:"blog-comment-list-item"},[e("router-link",{attrs:{to:{name:"blog",params:{id:s.id}},replace:""}},[e("div",{staticClass:"blog-comment-list-item-avatar",on:{contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.handleCommentContextMenu(e,s.id)}}},[e("img",{attrs:{src:`https://zeqichat.xyz${s.avatar}`,alt:""}})])]),e("div",{staticClass:"blog-comment-list-item-content"},[e("div",{staticClass:"blog-comment-list-item-content-info"},[e("strong",[t._v(t._s(s.username))]),t._v(" · "+t._s(t.formatTime(s.create_time))+" ")]),e("div",{staticClass:"blog-comment-list-item-content-text",domProps:{textContent:t._s(t.filterMessage(s.msg))}})])],1)})),t.blog.commentList.length>t.last?e("li",{staticClass:"blog-comment-list-item"},[e("div",{staticClass:"blog-comment-list-item-more",on:{click:function(e){t.last+=5}}},[e("span",[t._v("查看更多")]),e("i",{staticClass:"el-icon-arrow-down"})])]):t._e(),t.last>=t.blog.commentList.length&&t.blog.commentList.length>1?e("li",{staticClass:"blog-comment-list-item"},[e("div",{staticClass:"blog-comment-list-item-more",on:{click:function(e){t.last=1}}},[e("span",[t._v("收起评论")]),e("i",{staticClass:"el-icon-arrow-up"})])]):t._e()],2)]):t._e()])],1)},a=[],o=s(4781),l=s(3648),n=function(){var t=this,e=t._self._c;return e("el-drawer-transition",[t._t("default")],2)},r=[],d=s(3766),m={name:"DrawerTransition",components:{"el-drawer-transition":{functional:!0,render(t,e){const s={on:{beforeEnter(t){(0,d.addClass)(t,"drawer-transition"),t.dataset||(t.dataset={}),t.dataset.oldPaddingLeft=t.style.paddingLeft,t.dataset.oldPaddingRight=t.style.paddingRight,t.style.width="0",t.style.paddingLeft=0,t.style.paddingRight=0},enter(t){t.dataset.oldOverflow=t.style.overflow,0!==t.scrollWidth?(t.style.width=t.scrollWidth+"px",t.style.paddingLeft=t.dataset.oldPaddingLeft,t.style.paddingRight=t.dataset.oldPaddingRight):(t.style.width="",t.style.paddingLeft=t.dataset.oldPaddingLeft,t.style.paddingRight=t.dataset.oldPaddingRight),t.style.overflow="hidden"},afterEnter(t){(0,d.removeClass)(t,"drawer-transition"),t.style.width="",t.style.overflow=t.dataset.oldOverflow},beforeLeave(t){t.dataset||(t.dataset={}),t.dataset.oldPaddingLeft=t.style.paddingLeft,t.dataset.oldPaddingRight=t.style.paddingRight,t.dataset.oldOverflow=t.style.overflow,t.style.width=t.scrollWidth+"px",t.style.overflow="hidden"},leave(t){0!==t.scrollWidth&&((0,d.addClass)(t,"drawer-transition"),t.style.width=0,t.style.paddingLeft=0,t.style.paddingRight=0)},afterLeave(t){(0,d.removeClass)(t,"drawer-transition"),t.style.width="",t.style.overflow=t.dataset.oldOverflow,t.style.paddingLeft=t.dataset.oldPaddingLeft,t.style.paddingRight=t.dataset.oldPaddingRight}}};return t("transition",s,e.children)}}}},c=m,g=s(1001),h=(0,g.Z)(c,n,r,!1,null,"00fd5540",null),u=h.exports,b=s(3822),p={name:"BlogItem",data(){return{comment:"",isRequest:!1,height:"0px",last:3,isCollapse:!1}},components:{DrawerTransition:u},props:{blog:{type:Object,required:!0}},computed:{imageList(){return JSON.parse(this.blog.images).map((t=>`https://zeqichat.xyz${t}`))},...(0,b.rn)({token:t=>t.user.token,avatar:t=>t.user.avatar,username:t=>t.user.username,userId:t=>t.user.userId})},methods:{formatTime:o.Z,formatMessage:l.w,filterMessage:l.t,commentBlog(){this.comment.trim()&&(this.isRequest||(this.isRequest=!0,this.$axios.post("/api/blog/comment",{blog_id:this.blog.blog_id,user:this.token,msg:this.comment}).then((t=>{t.data.ok&&(this.$emit("commentBlog",this.blog.blog_id,this.comment),this.comment="")})).finally((()=>{this.isRequest=!1}))))},deleteBlog(){this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{this.$emit("deleteBlog",this.blog.blog_id),this.$axios.delete(`/api/blog?id=${this.blog.blog_id}&user=${this.token}`).then((t=>{t.data.ok||this.$notify.error({title:"出错",message:t.data.msg,offset:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--safe-top"))})}))})).catch((()=>{}))},adjustHeight(){this.height=this.$refs.blogItem?.clientHeight-32+"px"},collapse(){this.isCollapse=!this.isCollapse},handleContextMenu(t){this.$store.commit("SET_STATE",{x:t.clientX,y:t.clientY,menuList:[{label:"私聊",command:"chat",id:this.blog.id,icon:"el-icon-chat-line-round"},{label:"动态",command:"blog",id:this.blog.id,icon:"el-icon-document"}],isShow:!0})},handleCommentContextMenu(t,e){this.$store.commit("SET_STATE",{x:t.clientX,y:t.clientY,menuList:[{label:"私聊",command:"chat",id:e,icon:"el-icon-chat-line-round"},{label:"动态",command:"blog",id:e,icon:"el-icon-document"}],isShow:!0})}},mounted(){if(window.innerWidth>600){this.adjustHeight();const t=new ResizeObserver((t=>{this.adjustHeight()}));t.observe(this.$refs.blogItem)}else this.height="unset"}},f=p,v=(0,g.Z)(f,i,a,!1,null,"4398b528",null),C=v.exports}}]);